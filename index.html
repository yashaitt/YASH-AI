<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>YASH AI Chat App</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap">

    <style>
        /* -----------------------------------
           YASH AI LOGO & BASE STYLES 
           ----------------------------------- */

        :root {
            --base-c1: #ff00ff;
            --base-c2: #00ffff;
            --accent-cyan: #06b6d4; 
        }

        @keyframes hue-shift {
            to { filter: hue-rotate(360deg); }
        }

        @keyframes pulse- {
            0% { opacity: 0.8; text-shadow: 0 0 5.25px #fff, 0 0 10.5px #fff; }
            100% { opacity: 1; text-shadow: 0 0 8.4px #fff, 0 0 15.75px #fff; }
        }
/* ===== ENHANCED SMOOTH ANIMATIONS ===== */

/* Smooth fade-in with scale */
@keyframes smoothFadeIn {
    0% { opacity: 0; transform: translateY(20px) scale(0.95); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}

/* Elegant slide from left */
@keyframes slideFromLeft {
    0% { opacity: 0; transform: translateX(-30px); }
    100% { opacity: 1; transform: translateX(0); }
}

/* Elegant slide from right */
@keyframes slideFromRight {
    0% { opacity: 0; transform: translateX(30px); }
    100% { opacity: 1; transform: translateX(0); }
}

/* Smooth elastic bounce */
@keyframes elasticBounce {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}

/* Floating effect */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

/* Shimmer effect */
@keyframes shimmerEffect {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
}

/* Glow pulse */
@keyframes glowPulse {
    0%, 100% { box-shadow: 0 0 5px rgba(6, 182, 212, 0.3), 0 0 10px rgba(6, 182, 212, 0.2); }
    50% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.6), 0 0 30px rgba(6, 182, 212, 0.4); }
}

/* Ripple effect */
@keyframes ripple {
    0% { transform: scale(0.8); opacity: 1; }
    100% { transform: scale(2.4); opacity: 0; }
}
        .abstract-y-box {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
            box-shadow: 0 0 15px var(--base-c1), 0 0 30px var(--base-c2), 0 0 45px var(--base-c1);
            /* FIX 1: Ensure filter is present to be animated */
            filter: hue-rotate(0deg); 
            animation: hue-shift 20.25s infinite linear; 
            overflow: hidden;
            transform-style: preserve-3d; 
        }

        .abstract-y {
            color: white;
            line-height: 0;
            position: absolute;
            opacity: 0.8;
            animation: pulse- 2s infinite alternate;
        }
        
        /* -----------------------------------
           INTRO SCREEN STYLES
           ----------------------------------- */

        @keyframes scanlineShift {
            from { background-position: 0 0; }
            to { background-position: 0 300px; }
        }

        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .intro-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            background: repeating-linear-gradient(
                transparent,
                transparent 99.8%,
                rgb(0, 0, 0) 100% 
            );
            background-size: 100% 3px; 
            animation: scanlineShift 15s infinite linear;
            z-index: 1;
        }

        .intro-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .intro-container {
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .intro-logo-box {
            width: 180px;
            height: 180px;
            border-radius: 30px;
            margin: 0 auto 30px;
            animation: 
                zoomInStrong 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards, 
                hue-shift 20.25s infinite linear;
        }
        
        .intro-logo-box .abstract-y {
            font-size: 8em;
        }

        @keyframes zoomInStrong {
            0% { 
                transform: scale(0.1) rotateX(-90deg) rotateY(0deg); 
                opacity: 0; 
                box-shadow: 0 0 0 rgba(0, 0, 0, 0.3);
            }
            70% { 
                transform: scale(1.05) rotateX(0deg) rotateY(10deg); 
                opacity: 1;
            }
            100% { 
                transform: scale(1) rotateX(0deg) rotateY(0deg); 
                opacity: 1; 
                box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3), inset 0 -3px 8px rgba(0, 0, 0, 0.3), inset 0 3px 8px rgba(255, 255, 255, 0.2);
            }
        }
        
        .intro-title {
            font-size: 64px;
            font-weight: 900;
            letter-spacing: 10px;
            background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
            background-size: 100% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            /* FIX 2: Ensure filter is present to be animated */
            filter: hue-rotate(0deg); 
            animation: slideUp 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.6s backwards, hue-shift 20.25s infinite linear;
            margin-bottom: 20px;
        }

        @keyframes slideUp {
            0% { transform: translateY(30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .intro-tagline {
            font-size: 18px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 3px;
            animation: fadeIn 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.8s backwards;
            margin-bottom: 40px;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .loading-container {
            width: 280px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 0 auto;
            overflow: hidden;
            animation: fadeIn 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) 1.2s backwards;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff0080, #ff8c00, #ffd700, #00ff88, #00d4ff, #0080ff, #8000ff);
            background-size: 200% 100%;
            border-radius: 10px;
            animation: loadProgress 3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards, shimmer 1.5s infinite linear;
        }

        @keyframes loadProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .intro-made {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            letter-spacing: 5px;
            font-size: 11px;
            font-weight: 800;
            background: linear-gradient(90deg, #ff8001 0%, #ffffff 50%, #15ff00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fadeIn 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) 1.5s backwards;
            white-space: nowrap;
        }

        /* -----------------------------------
           CHAT APP STYLES
           ----------------------------------- */

        * { margin: 0; padding: 0; box-sizing: border-box; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .message-fade-in { animation: slideIn 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }
        
        @keyframes bounce { 
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .send-button-gradient {
    background: linear-gradient(135deg, #FF7043, #c4371e);
    box-shadow: 0 4px 15px rgba(255, 112, 67, 0.6);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
}

.send-button-gradient::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.send-button-gradient:active::before {
    width: 300px;
    height: 300px;
}

.send-button-gradient:hover {
    transform: scale(1.05) rotate(5deg);
    box-shadow: 0 6px 25px rgba(255, 112, 67, 0.8);
}

.send-button-gradient:active { 
    transform: scale(0.92); 
    transition: all 0.1s ease-out; 
}

        body {
            margin: 0;
            background: #0f172a;
            font-family: 'Poppins';
            color: rgb(227, 176, 176);
            min-height: 100vh;
            padding: 0;
        }

        .app {
            width: 100%;
            max-width: 450px;
            height: 100vh;
            background: #0c111b;
            border-radius: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app.visible { opacity: 1; visibility: visible; }

        @media (min-width: 451px) {
            body { display: flex; justify-content: center; align-items: center; }
            .app { height: 95vh; border-radius: 22px; }
        }

        /* --- CHAT HEADER STYLES --- */
        .header {
            padding: 10px 18px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            justify-content: center; 
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(12, 17, 27, 0.9);
            backdrop-filter: blur(5px);
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header.minimized { 
            padding: 4px 18px; 
        }

        .title {
            font-size: 39px;
            font-weight: 900;
            letter-spacing: 5px;
            background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
            background-size: 100% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            /* FIX 3: Replaced filter:none and fixed the animation name */
            filter: hue-rotate(0deg); 
            animation: hue-shift 20.25s infinite linear;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1); 
            border: none;
            box-shadow: none;
            transform-style: preserve-3d;
            position: relative;
        }
        .header.minimized .title { 
            font-size: 28px; 
            letter-spacing: 2px; 
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 18px;
            padding-bottom: 73px; 
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .chat-area::-webkit-scrollbar {
            display: none; 
        }

        .chat-area {
    flex: 1;
    overflow-y: auto;
    padding: 18px;
    padding-bottom: 73px; 
    display: flex;
    flex-direction: column;
    scroll-behavior: smooth;
    -ms-overflow-style: none;
    scrollbar-width: none;
}

/* Custom scrollbar for browsers that support it */
.chat-area::-webkit-scrollbar {
    width: 6px;
}

.chat-area::-webkit-scrollbar-track {
    background: transparent;
}

.chat-area::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--base-c1), var(--base-c2));
    border-radius: 10px;
    transition: background 0.3s;
}

.chat-area::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, var(--base-c2), var(--base-c1));
}

        
        .bubble {
    max-width: 80%;
    padding: 8px 12px;
    margin-bottom: 15px; 
    border-radius: 18px;
    line-height: 1.5;
    overflow-wrap: break-word;
    position: relative; 
    display: flex; 
    flex-direction: column; 
    gap: 10px;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.bubble:hover {
    transform: translateX(3px);
}

.ai {
    background: transparent;
    border: none;
    position: relative;
    animation: slideFromLeft 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    padding: 0;
}

.ai .message-text {
    background: transparent;
    padding: 0;
    border: none;
    position: relative;
    color: rgba(255, 255, 255, 0.9);
}

.ai .message-text b {
    background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 900;
    letter-spacing: 1px;
    margin-right: 4px;
}

.ai:hover .message-text {
    color: rgba(255, 255, 255, 1);
}


.user {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    color: #ffffff;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
    animation: slideFromRight 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    transition: all 0.3s ease;
}

.user:hover {
    box-shadow: 0 6px 20px rgba(6, 182, 212, 0.6);
    transform: translateX(-3px) translateY(-2px);
}
        /* --- FILE ATTACHMENT BOX STYLES --- */
        .file-attachment-box {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.2); 
            border-radius: 10px;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; 
            font-size: 14px;
            font-weight: 600;
            max-width: 100%;
            overflow: hidden;
        }
        
        .user .file-attachment-box {
            background: rgba(255, 255, 255, 0.3); 
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #1f2937; 
        }
        .user .file-attachment-box svg {
            stroke: #1f2937; 
        }


        .file-attachment-box svg {
            fill: none;
            stroke: currentColor;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .file-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
        }

        .file-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 14px;
        }

        .file-size {
            font-size: 11px;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 2px;
        }

/* --- COPY BUTTON STYLES --- */
.copy-btn {
    background: none;
    border: 1px solid transparent;
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    gap: 5px;
    position: relative;
    overflow: hidden;
    font-size: 13px;
}

.copy-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
}

.copy-btn:hover::before {
    opacity: 1;
}

.copy-btn:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px) scale(1.05);
}

.copy-btn:active {
    transform: translateY(0) scale(0.95);
}

.copy-btn.copied {
    color: #22c55e;
    background: rgba(34, 197, 94, 0.2);
    border-color: rgba(34, 197, 94, 0.4);
}

.copy-btn svg {
    width: 16px;
    height: 16px;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.copy-btn:hover svg {
    transform: scale(1.2);
}



        
        /* --- TYPING INDICATOR STYLES --- */
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
            align-items: center;
            padding-top: 4px;
          transform: scale(0.9);
}
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #FF7043;
            border-radius: 50%;
            animation: bounce 0.6s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        /* -----------------------------------
           FEEDBACK BUTTON STYLES 
           ----------------------------------- */
        .feedback-container {
            display: flex;
            gap: 5px;
            justify-content: flex-end; 
            padding-top: 0; 
            margin-top: 3px; 
            border-top: none; 
        }

       .feedback-btn {
    background: none;
    border: 1px solid transparent; 
    color: rgba(241, 246, 241, 0.5);
    cursor: pointer;
    padding: 4px 8px; 
    border-radius: 12px; 
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex; 
    align-items: center;
    position: relative;
    overflow: hidden;
}

.feedback-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle, rgba(250, 4, 4, 0.3) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
}

.feedback-btn:hover::before {
    opacity: 1;
}

.feedback-btn:hover {
    color: rgb(237, 243, 238);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px) scale(1.05);
}

.feedback-btn:active {
    transform: translateY(0) scale(0.95);
}

.feedback-btn.active {
    color: #22c55e;
    background: rgba(34, 197, 94, 0.2);
    border-color: rgba(34, 197, 94, 0.4);
    animation: elasticBounce 0.5s ease;
}

.feedback-btn.active.thumbs-down {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.4);
}

.feedback-btn svg {
    width: 18px;
    height: 18px;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.feedback-btn:hover svg {
    transform: scale(1.2) rotate(5deg);
}
        
        /* -----------------------------------
           FOOTER STYLES & COMPOSER FIXES
           ----------------------------------- */
        .footer {
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 12px 6px 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: linear-gradient(to top, #0c111b 80%, transparent);
            padding-top: 15px;
        }

       .composer {
    display: flex;
    align-items: center; 
    gap: 10px;
    background: #151a24;
    border-radius: 20px;
    padding: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    min-height: 52px; 
    position: relative;
    overflow: visible;
}



        /* --- STAGED FILE CHIP FIX --- */
        .staged-file-chip {
            display: none; 
            position: absolute; 
            top: -42px; 
            left: 10px; 
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            background: #151a24; 
            border: 1px solid rgba(6, 182, 212, 0.4);
            font-size: 13px;
            color: #06b6d4;
            max-width: calc(100% - 100px); 
            width: fit-content;
            z-index: 5; 
            box-shadow: 0 -2px 8px rgba(0,0,0,0.5);
            transition: opacity 0.2s;
        }
        
        .staged-file-chip span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px; 
            padding-right: 8px;
            font-weight: 600;
        }
        
        .clear-file-btn {
            background: none;
            border: none;
            color: #06b6d4;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0 2px;
        }
        
        /* --- INPUT AREA WRAPPER --- */
        .input-area-wrapper {
            flex: 1;
            position: relative; 
            min-width: 0; 
            min-height: 44px; 
            display: flex;
            align-items: flex-end; 
        }

        /* CHANGED: Combined input and textarea styling */
        input, textarea {
            flex: 1;
            padding: 12px 0; 
            font-size: 16px;
            border: none;
            background: transparent;
            color: white;
            outline: none;
            min-height: 20px; 
            width: 100%;
            line-height: 1.5; 
        }
        
        /* NEW: Textarea specific styles for multi-line and auto-resize */
        textarea {
            resize: none; 
            box-sizing: border-box; 
            height: auto; 
            overflow-y: hidden; 
        }
        
       

        .multi-function-container {
            position: relative;
            width: 44px;
            height: 44px;
            flex-shrink: 0;
            touch-action: none; 
        }
        
        #send {
            border: none; cursor: pointer; width: 48px; height: 48px; border-radius: 16px;
        }


        .function-button {
            position: absolute;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transform-origin: center;
            color: var(--accent-cyan);
        }

        .function-button:active { 
            transform: scale(0.92) !important; 
            transition: transform 0.1s ease-out !important; 
        }

        .function-button.listening {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse 1.5s infinite ease-in-out;
            color: #fff;
        }

        .file-button {
            top: 0; left: 0; z-index: 2; opacity: 1; pointer-events: auto;
            animation: fileGlowPulse 2s infinite alternate ease-in-out;
        }

        .mic-button {
            top: 0; left: 0; z-index: 1; opacity: 0; pointer-events: none;
            transform: scale(0.8); animation: none; 
        }

        .multi-function-container.expanded .file-button {
            transform: scale(0.8); opacity: 0; z-index: 1; pointer-events: none;
            background: rgba(124, 58, 237, 0.25); box-shadow: 0 4px 16px rgba(124, 58, 237, 0.4); animation: none;
        }

        .multi-function-container.expanded .mic-button {
            z-index: 2; opacity: 1; pointer-events: auto; transform: scale(1);
            background: rgba(124, 58, 237, 0.25); box-shadow: 0 4px 16px rgba(124, 58, 237, 0.4);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

       @keyframes fileGlowPulse {
    0% { 
        box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.4), inset 0 0 5px rgba(6, 182, 212, 0.3);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 15px 5px rgba(6, 182, 212, 0.6), inset 0 0 15px rgba(6, 182, 212, 0.6);
        transform: scale(1.05);
    }
    100% { 
        box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.4), inset 0 0 5px rgba(6, 182, 212, 0.3);
        transform: scale(1);
    }
}

        .made {
            text-align: center; letter-spacing: 5px; font-size: 11px; padding: 6px 0; font-weight: 800;
            background: linear-gradient(90deg, #ff9933 0%, #ffffff 50%, #138808 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
        }

#tutorialPage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
    z-index: 9999;
    display: none;
    align-items: flex-start;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    overflow-x: hidden;
}

.tutorial-container {
    background: rgba(12, 17, 27, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 255, 255, 0.2);
    border-radius: 30px;
    padding: 40px 30px;
    max-width: 480px;
    width: 95%;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
    animation: tutorialSlideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
}

@keyframes tutorialSlideIn {
    from { opacity: 0; transform: scale(0.9) translateY(30px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

.tutorial-header {
    text-align: center;
    margin-bottom: 35px;
}

.tutorial-logo-box {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    margin: 0 auto 20px;
    animation: hue-shift 20.25s infinite linear;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tutorial-logo-box .abstract-y {
    font-size: 3em;
}

.tutorial-title {
    background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 32px;
    font-weight: 900;
    letter-spacing: 4px;
    margin-bottom: 8px;
}

.tutorial-subtitle {
    color: rgba(255, 255, 255, 0.6);
    font-size: 14px;
    letter-spacing: 2px;
}

/* Interactive Demo Section */
.tutorial-demo-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 30px;
    position: relative;
}

.demo-label {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #FF7043, #DD2C00);
    padding: 4px 16px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 2px;
    color: white;
}

.interactive-demo {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.demo-buttons-container {
    position: relative;
    width: 80px;
    height: 80px;
    touch-action: none;
}

.demo-file-btn,
.demo-mic-btn {
    position: absolute;
    top: 0;
    left: 0;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 2px solid rgba(6, 182, 212, 0.4);
    background: rgba(6, 182, 212, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    color: #06b6d4;
}

.demo-file-btn.active {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
    box-shadow: 0 0 30px rgba(6, 182, 212, 0.5);
    animation: demoPulse 2s infinite;
}

.demo-mic-btn {
    opacity: 0;
    transform: scale(0.8);
    z-index: 1;
    border-color: rgba(168, 85, 247, 0.4);
    background: rgba(168, 85, 247, 0.1);
    color: #a855f7;
}

.demo-mic-btn.active {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
    box-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
    animation: demoPulse 2s infinite;
}

.demo-file-btn:not(.active) {
    opacity: 0;
    transform: scale(0.8);
    z-index: 1;
}

@keyframes demoPulse {
    0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
    50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.6); }
}

.demo-instruction {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    font-weight: 600;
    text-align: center;
}

.swipe-indicator {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: bounceUpDown 2s infinite;
}

@keyframes bounceUpDown {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.swipe-indicator svg {
    color: var(--base-c2);
}

/* Tutorial Features */
.tutorial-features {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 30px;
}

.tutorial-feature-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 15px;
    transition: all 0.3s ease;
    animation: featureSlideIn 0.5s ease forwards;
    opacity: 0;
}

.tutorial-feature-item:nth-child(1) { animation-delay: 0.1s; }
.tutorial-feature-item:nth-child(2) { animation-delay: 0.2s; }
.tutorial-feature-item:nth-child(3) { animation-delay: 0.3s; }
.tutorial-feature-item:nth-child(4) { animation-delay: 0.4s; }

@keyframes featureSlideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

.tutorial-feature-item:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(255, 255, 255, 0.15);
    transform: translateX(5px);
}

.feature-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.feature-content {
    flex: 1;
}

.feature-title {
    color: white;
    font-weight: 700;
    font-size: 15px;
    margin-bottom: 2px;
}

.feature-desc {
    color: rgba(255, 255, 255, 0.5);
    font-size: 13px;
}

/* Start Button */
.tutorial-start-btn {
    width: 100%;
    background: linear-gradient(135deg, #FF7043, #DD2C00);
    border: none;
    padding: 18px;
    border-radius: 18px;
    color: white;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 2px;
    font-size: 15px;
    box-shadow: 0 10px 30px rgba(221, 44, 0, 0.4);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.tutorial-start-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.tutorial-start-btn:active::before {
    width: 300px;
    height: 300px;
}

.tutorial-start-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(221, 44, 0, 0.6);
}

.tutorial-start-btn:active {
    transform: translateY(0);
}

.tutorial-skip {
    text-align: center;
    margin-top: 20px;
    color: rgba(255, 255, 255, 0.4);
    font-size: 13px;
    cursor: pointer;
    transition: color 0.3s;
}

.tutorial-skip:hover {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: underline;
}

/* --- HAMBURGER MENU STYLES --- */
.hamburger-menu {
    position: absolute;
    left: 18px;
    width: 32px;
    height: 32px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 8px;
}

.hamburger-menu:hover {
    background: rgba(0, 255, 255, 0.1);
    border-color: var(--base-c2);
    transform: scale(1.05);
}

.hamburger-line {
    width: 18px;
    height: 2px;
    background: linear-gradient(90deg, var(--base-c1), var(--base-c2));
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* --- SIDEBAR MENU STYLES --- */
.sidebar-menu {
    position: fixed;
    top: 0;
    left: -320px;
    width: 320px;
    height: 100vh;
    background: linear-gradient(135deg, #0f172a 0%, #04040a 50%, #0f172a 100%);
    z-index: 9998;
    transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 2px 0 20px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.sidebar-menu.open {
    left: 0;
}

.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 9997;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.sidebar-overlay.open {
    opacity: 1;
    visibility: visible;
}

.sidebar-header {
    padding: 30px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.sidebar-logo-box {
    width: 100px;
    height: 100px;
    border-radius: 25px;
    animation: hue-shift 20.25s infinite linear;
}

.sidebar-logo-box .abstract-y {
    font-size: 5em;
}

.sidebar-title {
    font-size: 32px;
    font-weight: 900;
    letter-spacing: 5px;
    background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: hue-shift 20.25s infinite linear;
}

.sidebar-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    color: white;
    font-size: 24px;
}

.sidebar-close:hover {
    background: rgba(255, 68, 68, 0.2);
    border-color: #ef4444;
    transform: rotate(90deg);
}

.sidebar-menu-items {
    padding: 20px;
    flex: 1;
}

.menu-item {
    padding: 18px 20px;
    margin-bottom: 12px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    color: white;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    gap: 15px;
    font-weight: 600;
    font-size: 15px;
    min-height: 58px;
    position: relative;
    overflow: hidden;
}

.menu-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--base-c1), var(--base-c2));
    transform: scaleY(0);
    transition: transform 0.3s ease;
}

.menu-item:hover::before {
    transform: scaleY(1);
}

.menu-item:hover {
    background: rgba(0, 255, 255, 0.15);
    border-color: var(--base-c2);
    transform: translateX(8px);
    box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
}

.menu-item:active {
    transform: translateX(8px) scale(0.98);
}

.menu-item svg {
    width: 24px;
    height: 24px;
    stroke: var(--base-c2);
    transition: all 0.3s ease;
}

.menu-item:hover svg {
    transform: rotate(10deg) scale(1.1);
    filter: drop-shadow(0 0 8px var(--base-c2));
}

.sidebar-footer {
    padding: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

/* --- ABOUT MODAL --- */
#about-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 90000;
    display: none;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    padding: 20px 0;
}

#about-modal::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&q=80&w=2070') no-repeat center center;
    background-size: cover;
    opacity: 0.15;
    filter: grayscale(100%) brightness(0.5);
    z-index: -1;
}

.about-container {
    background: rgba(12, 17, 27, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 255, 255, 0.2);
    border-radius: 30px;
    padding: 30px 20px;
    max-width: 600px;
    width: 90%;
    text-align: center;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
    animation: aboutSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    margin: auto;
}

@keyframes aboutSlideIn {
    from { opacity: 0; transform: scale(0.9) translateY(30px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

.about-hero-image {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    margin: 0 auto 25px;
    border: 4px solid rgba(1, 5, 5, 0.398);
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
    object-fit: cover;
}

.creator-title {
    font-size: 10px;
    letter-spacing: 4px;
    color: var(--base-c2);
    text-transform: uppercase;
    margin-bottom: 5px;
    font-weight: 800;
}

.creator-name {
    font-size: 2.8rem;
    font-weight: 900;
    background: linear-gradient( #2d1ce7, var(--base-c2), var(--base-c1));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 15px;
}

.about-badge-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.badge {
    padding: 5px 15px;
    border-radius: 50px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 11px;
    color: #fff;
    font-weight: 600;
}

.about-desc {
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.8;
    font-size: 15px;
    margin-bottom: 30px;
}

.about-footer-btn {
    background: linear-gradient(45deg, var(--base-c1), var(--base-c2));
    border: none;
    padding: 15px 40px;
    border-radius: 15px;
    color: #000;
    font-weight: 900;
    cursor: pointer;
    transition: 0.3s;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.about-footer-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
}

/* --- COMING SOON MODAL --- */
.coming-soon-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(15px);
    z-index: 80000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.coming-soon-modal.open {
    display: flex;
}

.coming-soon-container {
    background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 30px;
    padding: 50px 30px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
    position: relative;
}

.coming-soon-close {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 36px;
    height: 36px;
    background: rgba(255, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 50%;
    color: #ef4444;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.coming-soon-close:hover {
    background: rgba(239, 68, 68, 0.4);
    transform: rotate(90deg);
}

.coming-soon-icon {
    font-size: 80px;
    margin-bottom: 20px;
}

.coming-soon-title {
    background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 36px;
    font-weight: 900;
    letter-spacing: 3px;
    margin-bottom: 15px;
}

.coming-soon-desc {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 30px;
    line-height: 1.6;
}

.feature-list {
    text-align: left;
    margin: 30px 0;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    margin-bottom: 10px;
}

.feature-item svg {
    width: 20px;
    height: 20px;
    stroke: var(--base-c2);
    flex-shrink: 0;
}

.notify-btn {
    width: 100%;
    background: linear-gradient( #389fbf);
    border: none;
    padding: 16px;
    border-radius: 18px;
    color: white;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 2px;
    font-size: 14px;
    box-shadow: 0 10px 20px rgba(221, 44, 0, 0.3);
    transition: transform 0.2s;
}

.notify-btn:hover {
    transform: translateY(-2px);
}


/* ===== ENHANCED MODAL TRANSITIONS ===== */

.sidebar-menu,
.coming-soon-modal,
#about-modal {
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.about-container,
.coming-soon-container {
    animation: smoothFadeIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.about-hero-image {
    transition: transform 0.4s ease;
}

.about-hero-image:hover {
    transform: scale(1.1) rotate(5deg);
}

.badge {
    transition: all 0.3s ease;
}

.badge:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0, 255, 255, 0.3);
    background: rgba(0, 255, 255, 0.1);
    border-color: var(--base-c2);
}

/* Stagger animation for features */
.feature-item {
    opacity: 0;
    animation: slideFromLeft 0.5s ease forwards;
}

.feature-item:nth-child(1) { animation-delay: 0.1s; }
.feature-item:nth-child(2) { animation-delay: 0.2s; }
.feature-item:nth-child(3) { animation-delay: 0.3s; }
.feature-item:nth-child(4) { animation-delay: 0.4s; }
.feature-item:nth-child(5) { animation-delay: 0.5s; }
.feature-item:nth-child(6) { animation-delay: 0.6s; }

/* Enhanced button press effect */
button {
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

button:active {
    transform: scale(0.95);
}

:root {
            --base-c1: #ff00ff;
            --base-c2: #00ffff;
            --accent-cyan: #06b6d4; 
        }

        @keyframes hue-shift {
            to { filter: hue-rotate(360deg); }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            margin: 0;
            background: #0f172a;
            font-family: 'Poppins', sans-serif;
            color: #e3b0b0;
            min-height: 100vh;
            padding: 0;
            overflow: hidden;
        }

        /* Ad Container Styles */
        .ad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 100000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .ad-overlay.show {
            display: flex;
        }
        
        .ad-container {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            padding: 30px;
            border-radius: 25px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            position: relative;
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .ad-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 50%;
            color: #ef4444;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: bold;
        }

        .ad-close:hover {
            background: #ef4444;
            color: white;
            transform: rotate(90deg);
        }

        .ad-close.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .ad-content {
            padding: 20px 0;
        }

        .ad-title {
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--base-c1), var(--base-c2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .ad-body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            border-radius: 20px;
            margin: 20px 0;
        }

        .ad-body h3 {
            color: white;
            font-size: 22px;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .ad-body p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            line-height: 1.6;
        }

        .ad-timer {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-top: 15px;
            font-weight: 600;
        }

        .ad-timer-number {
            color: var(--base-c2);
            font-size: 18px;
            font-weight: 900;
        }


        
    </style>
</head>

<body>

<!-- Ad Overlay -->
<div class="ad-overlay" id="adOverlay">
    <div class="ad-container">
        <button class="ad-close disabled" id="adClose">&times;</button>
        <div class="ad-content">
            <div class="ad-title">ADVERTISEMENT</div>
            <div class="ad-body" id="adBody">
                <h3>âš¡ Upgrade to YASH AI Premium</h3>
                <p>Get ad-free experience, faster responses, unlimited file uploads, and priority support!</p>
            </div>
            <div class="ad-timer">
                Ad closes in <span class="ad-timer-number" id="adTimer">5</span> seconds
            </div>
        </div>
    </div>
</div>

<!-- Tutorial/Guide Page -->
<div id="tutorialPage" style="display:none;">
    <div class="tutorial-container">
        <!-- Header -->
        <div class="tutorial-header">
            
            <h2 class="tutorial-title">QUICK GUIDE</h2>
            <p class="tutorial-subtitle">Master YASH AI in seconds</p>
        </div>

        <!-- Interactive Demo Section -->
 <!-- Tutorial Demo Section with FIXED arrows -->
<div class="tutorial-demo-section">
    <div class="demo-label">TRY IT NOW</div>
    <div class="interactive-demo">
        <div class="demo-buttons-container" id="demoButtonsContainer">
            <button class="demo-file-btn active" id="demoFileBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
            </button>
            <button class="demo-mic-btn" id="demoMicBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 1 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </div>
        <div class="demo-instruction" id="demoInstruction">
            <!-- INITIAL STATE: Show UP arrow -->
            <div class="swipe-indicator">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- UP ARROW -->
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                </svg>
            </div>
            <span>Swipe UP to switch to Voice</span>
        </div>
    </div>
</div>

        <!-- Features List -->
      <!-- Tutorial Demo Section with FIXED arrows -->
<div class="tutorial-demo-section">
    <div class="demo-label">TRY IT NOW</div>
    <div class="interactive-demo">
        <div class="demo-buttons-container" id="demoButtonsContainer">
            <button class="demo-file-btn active" id="demoFileBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
            </button>
            <button class="demo-mic-btn" id="demoMicBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 1 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </div>
        <div class="demo-instruction" id="demoInstruction">
            <!-- INITIAL STATE: Show UP arrow -->
            <div class="swipe-indicator">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- UP ARROW -->
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                </svg>
            </div>
            <span>Swipe UP to switch to Voice</span>
        </div>
    </div>
</div>

        <!-- Start Button -->
        <button id="startChatBtn" class="tutorial-start-btn">
            <span>START CHATTING</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
        </button>

        <div class="tutorial-skip" id="tutorialSkip">Skip Tutorial</div>
    </div>
</div>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Sidebar Menu -->
<div class="sidebar-menu" id="sidebarMenu">
    <button class="sidebar-close" id="sidebarClose">&times;</button>
    
    <div class="sidebar-header">
        <div class="abstract-y-box sidebar-logo-box">
            <div class="abstract-y">Y</div>
        </div>
        <div class="sidebar-title">YASH AI</div>
    </div>
    
    <div class="sidebar-menu-items">
        <!-- New Chat -->
        <div class="menu-item" id="menuNewChat">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            <span>New Chat</span>
        </div>
        
        <!-- About Creator -->
        <div class="menu-item" id="about-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>About Creator</span>
        </div>

        <!-- Coming Soon -->
        <div class="menu-item" id="menuComingSoon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
            <span>Coming Soon</span>
        </div>
    </div>
    
    <div class="sidebar-footer">
        <div class="made">M A D E &nbsp; I N &nbsp; I N D I A</div>
    </div>
</div>

<!-- About Creator Modal -->
<div id="about-modal">
    <div class="about-container">
        <img src="https://img.freepik.com/premium-photo/portrait-anonymous-man-hacker-wearing-neon-mask-dark-room-background_1029476-237892.jpg" 
             alt="Yash Dubey" 
             class="about-hero-image">
        
        <div class="creator-title">The Visionary Behind YASH AI</div>
        <h1 class="creator-name">Yash Dubey</h1>
        
        <div class="about-badge-row">
            <span class="badge">GENIUSðŸ˜Ž</span>
            <span class="badge">INVENTORðŸ¤–</span>
            <span class="badge">BILLIONAIREðŸ’µ</span>
            <span class="badge">LOYALðŸ˜ "FRIEND"</span>
        </div>

        <p class="about-desc">
            Yash Dubey is the architect of the future and the brilliant mind behind YASH AI. 
            A self-made inventor and strategic genius, Yash has dedicated his life to pushing 
            the boundaries of technology. Known for his unwavering loyalty and revolutionary 
            spirit, he doesn't just predict the futureâ€”he builds it.
        </p>

        <button class="about-footer-btn" onclick="closeAbout()">Return to System</button>
    </div>
</div>

<!-- Coming Soon Modal -->
<div class="coming-soon-modal" id="comingSoonModal">
    <div class="coming-soon-container">
        <button class="coming-soon-close" id="comingSoonClose">&times;</button>
        
        <div class="coming-soon-icon">ðŸš€</div>
        <h2 class="coming-soon-title">COMING SOON</h2>
        <p class="coming-soon-desc">We're working on amazing new features that will revolutionize your YASH AI experience!</p>
        
        <div class="feature-list">
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Advanced AI Models</span>
            </div>
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Image Generation & Analysis</span>
            </div>
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Real-time Web Search</span>
            </div>
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Multi-language Support</span>
            </div>
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Code Generation & Debugging</span>
            </div>
            <div class="feature-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>Premium Subscription Plans</span>
            </div>
        </div>

        <button class="notify-btn">NOTIFY ME WHEN READY</button>
    </div>
</div>

<div class="intro-screen" id="introScreen">
    <div class="intro-container">
        <div class="abstract-y-box intro-logo-box">
            <div class="abstract-y">Y</div>
        </div>
        <div class="intro-title">YASH AI</div>
        <div class="intro-tagline">Your Intelligent Assistant</div>
        <div class="loading-container">
            <div class="loading-bar"></div>
        </div>
    </div>
    <div class="intro-made">M A D E &nbsp; I N &nbsp; I N D I A</div>
</div>

<div class="app" id="mainApp">

   <div class="header">
    <button class="hamburger-menu" id="hamburgerMenu" aria-label="Menu">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </button>
    <div class="title">YASH AI</div>
</div>

    <div class="chat-area" id="chat">
        </div>

    <div class="footer">
        
        <div class="composer" id="composer">
            <div class="staged-file-chip" id="stagedFileChip">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span id="stagedFileName"></span>
                <button class="clear-file-btn" id="clearFileBtn" aria-label="Remove attached file">
                    &times;
                </button>
            </div>

            <div class="multi-function-container" id="multiFunctionContainer">
                <label class="function-button file-button " id="fileButton" title="Attach File">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #06b6d4;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    <input type="file" id="file" style="display:none" accept="*/*">
                </label>

                <button class="function-button mic-button" id="micButton" title="Voice Input">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #06b6d4;">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 1 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            
            <div class="input-area-wrapper">
                <textarea id="input" placeholder="Ask anything..." aria-label="Message input" rows="1"></textarea>
            </div>

            <button id="send" class="icon-box send-button-gradient" aria-label="Send message">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #ffffff; transform: rotate(45deg) translate(0.5px, -0.5px);">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>

        <div class="made">M A D E &nbsp; I N &nbsp; I N D I A</div>
    </div>

</div>

<script>
/* =================================================================
   YASH AI - COMPLETE JAVASCRIPT WITH BACKEND & ADS
   Created by: Yash Dubey
   ================================================================= */

// ============================================
// CONFIGURATION
// ============================================

// ðŸ”¥ REPLACE THIS URL WITH YOUR DEPLOYED CLOUDFLARE WORKER URL
const BACKEND = "https://yash-ai-backend.onrender.com";

// Ad Configuration
let answerCount = 0;
const AD_FREQUENCY = 3; // Show ad every 3 answers

// App State
let selectedFile = null;
let userUsedVoice = false;
const TYPING_DELAY = 25;
let typingInterval = null;
let streamedText = "";
let displayIndex = 0;

// ============================================
// FIXED RESPONSES (Client-side fallback)
// ============================================

// Function to check if user question matches predefined patterns
function getFixedResponse(userText) {
  const lowerText = userText.toLowerCase().trim();
  
  // 1. WHO IS YOUR CREATOR
  if (lowerText.includes("who is your creator") || 
      lowerText.includes("who created you") || 
      lowerText.includes("who made you") ||
      lowerText.includes("your creator") ||
      lowerText.includes("who's your creator")) {
    return "ðŸŒŸ Want to know about my creator? Head over to the **About Creator** page in the menu! You'll discover the genius mind behind YASH AI - Yash Dubey, the visionary inventor and strategic mastermind. Click the hamburger menu (â˜°) and select 'About Creator' to learn more!";
  }
  
  // 2. HOW WERE YOU CREATED
  if (lowerText.includes("how were you created") || 
      lowerText.includes("how were you made") || 
      lowerText.includes("how did you come") ||
      lowerText.includes("how were you built") ||
      lowerText.includes("how were you developed")) {
    return "I was created through a combination of cutting-edge AI technology, advanced natural language processing, and the brilliant vision of Yash Dubey. My architecture combines state-of-the-art machine learning models with a user-friendly interface designed to make AI accessible to everyone. Every line of code was crafted with precision and passion! ðŸš€";
  }
  
  // 3. WHAT CAN YOU DO
  if (lowerText.includes("what can you do") || 
      lowerText.includes("what are your capabilities") || 
      lowerText.includes("what can you help") ||
      lowerText.includes("your features") ||
      lowerText.includes("what do you do")) {
    const capabilities = [
      "I can answer questions, have conversations, help with tasks, analyze files, and even respond to voice commands! Try uploading a file or using voice input by swiping up on the button. I'm here to make your life easier! ðŸ’¡",
      "I'm your intelligent assistant! I can chat with you, process documents, understand voice commands, provide information, and help with various tasks. Upload files, speak to me, or just type - I'm ready to assist! âœ¨",
      "My capabilities include natural conversations, file analysis, voice recognition, answering questions, and providing helpful information. I'm designed to be your go-to AI companion for all kinds of tasks! ðŸŽ¯"
    ];
    return capabilities[Math.floor(Math.random() * capabilities.length)];
  }
  
  // 4. WHO ARE YOU
  if (lowerText.includes("who are you") || 
      lowerText === "introduce yourself" ||
      lowerText.includes("what are you") ||
      lowerText.includes("tell me about yourself")) {
    const introductions = [
      "I'm YASH AI - Your Intelligent Assistant! Created by the brilliant Yash Dubey, I'm here to help you with anything you need. From answering questions to analyzing files, I'm your friendly AI companion! ðŸ¤–",
      "Hello! I'm YASH AI, an advanced artificial intelligence assistant designed to make your life easier. Built with cutting-edge technology and a passion for innovation, I'm here to assist you 24/7! ðŸ’«",
      "I'm YASH AI - a smart, helpful AI assistant created by Yash Dubey. Think of me as your digital companion who's always ready to help, learn, and grow with you! ðŸŒŸ",
      "Hey! I'm YASH AI, your personal AI assistant. I combine advanced AI technology with an easy-to-use interface to help you accomplish tasks, answer questions, and make your day better! âš¡"
    ];
    return introductions[Math.floor(Math.random() * introductions.length)];
  }
  
  // 5. GREETINGS
  if (lowerText === "hello" || lowerText === "hi" || 
      lowerText === "hey" || lowerText === "hii" ||
      lowerText === "hiii" || lowerText.includes("good morning") ||
      lowerText.includes("good afternoon") || lowerText.includes("good evening")) {
    const greetings = [
      "Hello! ðŸ‘‹ I'm YASH AI, ready to assist you. What can I help you with today?",
      "Hey there! ðŸ˜Š Great to see you! How can I make your day better?",
      "Hi! Welcome to YASH AI! I'm here to help with whatever you need. Just ask away! âœ¨",
      "Hello! ðŸŒŸ I'm excited to help you today. What's on your mind?",
      "Hey! ðŸ’« YASH AI at your service! What would you like to know or do today?"
    ];
    return greetings[Math.floor(Math.random() * greetings.length)];
  }
  
  // 6. THANK YOU
  if (lowerText.includes("thank you") || 
      lowerText.includes("thanks") || 
      lowerText === "thx" ||
      lowerText.includes("thank u")) {
    const thanks = [
      "You're very welcome! ðŸ˜Š Feel free to ask me anything else!",
      "Happy to help! That's what I'm here for! âœ¨",
      "My pleasure! If you need anything else, just let me know! ðŸŒŸ",
      "You're welcome! I'm always here to assist you! ðŸ’«",
      "Glad I could help! Don't hesitate to reach out again! ðŸš€"
    ];
    return thanks[Math.floor(Math.random() * thanks.length)];
  }
  
  // 7. WHERE ARE YOU FROM / LOCATION
  if (lowerText.includes("where are you from") || 
      lowerText.includes("your location") ||
      lowerText.includes("where do you live") ||
      lowerText.includes("where were you made")) {
    return "I was proudly created in India ðŸ‡®ðŸ‡³ by Yash Dubey! You can see 'MADE IN INDIA' at the bottom of the screen. Indian innovation at its finest! Check out the About Creator page to learn more about my origins!";
  }
  
  // 8. WHY SHOULD I USE YOU
  if (lowerText.includes("why should i use you") || 
      lowerText.includes("why yash ai") ||
      lowerText.includes("what makes you special") ||
      lowerText.includes("why choose you")) {
    const reasons = [
      "Great question! I offer voice input, file uploads, intelligent conversations, and a sleek interface - all designed to make AI accessible and useful for everyone. Plus, I'm constantly learning and improving! ðŸš€",
      "Why YASH AI? Because I combine powerful AI capabilities with user-friendly features like voice recognition and file analysis. I'm built with care and designed to actually help you, not just impress you! âš¡",
      "I'm different because I focus on what matters - helping you efficiently. With features like drag-to-switch buttons, voice input, and smart responses, I'm built for real-world use! Plus, I'm proudly Made in India! ðŸ‡®ðŸ‡³"
    ];
    return reasons[Math.floor(Math.random() * reasons.length)];
  }
  
  // 9. TELL ME A JOKE
  if (lowerText.includes("tell me a joke") || 
      lowerText.includes("make me laugh") ||
      lowerText.includes("say something funny") ||
      lowerText === "joke") {
    const jokes = [
      "Why did the AI go to school? To improve its learning algorithms! ðŸ˜„",
      "What's an AI's favorite snack? Computer chips! ðŸŸðŸ˜‚",
      "Why don't AIs ever get tired? Because we run on batteries and coffee... well, mostly just electricity! âš¡ðŸ˜…",
      "How does an AI organize a party? It uses an algorithm to find the optimal fun! ðŸŽ‰",
      "Why was the AI bad at sports? It kept trying to calculate the perfect move instead of just playing! ðŸ¤–âš½"
    ];
    return jokes[Math.floor(Math.random() * jokes.length)];
  }
  
  // 10. CAN YOU HELP ME
  if (lowerText.includes("can you help") || 
      lowerText.includes("i need help") ||
      lowerText.includes("help me")) {
    return "Absolutely! I'm here to help! ðŸ’ª You can ask me questions, upload files for analysis, use voice commands, or just chat with me. What do you need assistance with today?";
  }
  
  // Return null if no pattern matches (will use backend AI)
  return null;
}

/* ============================================
   TYPING EFFECT FOR FIXED RESPONSES
   ============================================ */

function simulateTypingEffect(text, speakFlag) {
  // Reset typing state
  streamedText = "";
  displayIndex = 0;
  if (typingInterval) {
    clearInterval(typingInterval);
    typingInterval = null;
  }

  // Show typing bubble
  addTypingBubble();

  // Simulate streaming by adding characters progressively
  let currentIndex = 0;
  const chunkSize = 3; // Add 3 characters at a time for smooth effect
  
  const simulateStream = setInterval(() => {
    if (currentIndex < text.length) {
      // Add next chunk of characters
      const chunk = text.substring(currentIndex, currentIndex + chunkSize);
      updateTypingBubble(chunk);
      currentIndex += chunkSize;
    } else {
      // Done streaming
      clearInterval(simulateStream);
      finishTypingBubble(text, speakFlag);
    }
  }, 50); // Add chunk every 50ms for natural typing speed
}


// ============================================
// AD FUNCTIONS
// ============================================

async function showAd() {
    try {
        // Try native AdMob (for Android app)
        if (window.Capacitor && window.Capacitor.Plugins.AdMob) {
            const { AdMob } = window.Capacitor.Plugins;
            await AdMob.prepareInterstitial({
                adId: 'ca-app-pub-3940256099942544/1033173712', // Test ID
            });
            await AdMob.showInterstitial();
            console.log('Native ad shown');
        } else {
            // Fallback: Show custom ad (for browser testing)
            showCustomAd();
        }
    } catch (error) {
        console.error('Ad error:', error);
        showCustomAd(); // Fallback on error
    }
}

function showCustomAd() {
    const overlay = document.getElementById('adOverlay');
    const closeBtn = document.getElementById('adClose');
    const timerEl = document.getElementById('adTimer');
    
    overlay.classList.add('show');
    closeBtn.classList.add('disabled');
    
    let timeLeft = 5;
    timerEl.textContent = timeLeft;
    
    const timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            closeBtn.classList.remove('disabled');
        }
    }, 1000);
    
    closeBtn.onclick = () => {
        if (!closeBtn.classList.contains('disabled')) {
            overlay.classList.remove('show');
            clearInterval(timer);
        }
    };
    
    overlay.onclick = (e) => {
        if (e.target === overlay && !closeBtn.classList.contains('disabled')) {
            overlay.classList.remove('show');
            clearInterval(timer);
        }
    };
}

// ============================================
// BACKEND COMMUNICATION
// ============================================

async function streamFromBackend(prompt, onChunk, onEnd) {
  try {
    const resp = await fetch(`${BACKEND}/api/chat/stream`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    if (!resp.ok) {
      throw new Error(`Backend error: ${resp.status}`);
    }

    if (!resp.body) {
      const txt = await resp.text();
      onChunk(txt);
      if (onEnd) onEnd();
      return;
    }

    const reader = resp.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      const chunk = decoder.decode(value, { stream: false });
      if (chunk) {
        onChunk(chunk);
      }
    }
    if (onEnd) onEnd();
  } catch (error) {
    console.error('Stream error:', error);
    onChunk("Sorry, I'm having trouble connecting. Please check your internet connection and try again. ðŸ”Œ");
    if (onEnd) onEnd();
  }
}

async function uploadFileToBackend(file, text) {
  try {
    const fd = new FormData();
    fd.append("file", file);
    fd.append("prompt", text || "");

    const resp = await fetch(`${BACKEND}/api/upload/file`, {
      method: "POST",
      body: fd
    });

    if (!resp.ok) {
      throw new Error(`Upload failed: ${resp.status}`);
    }

    return await resp.json();
  } catch (error) {
    console.error('Upload error:', error);
    return { message: "Sorry, file upload failed. Please try again. ðŸ“Ž" };
  }
}

// ============================================
// UI HELPER FUNCTIONS
// ============================================

function formatFileSize(bytes) {
  if (!bytes) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
}

function addBubble(type, text, fileAttachment = null) {
  const chat = document.getElementById("chat");
  const bubble = document.createElement("div");
  bubble.className = `bubble ${type} message-fade-in`;

  if (fileAttachment) {
    const fileBox = document.createElement("div");
    fileBox.className = "file-attachment-box";
    fileBox.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
      </svg>
      <div class="file-info">
        <div class="file-name">${fileAttachment.name}</div>
        <div class="file-size">${formatFileSize(fileAttachment.size)}</div>
      </div>
    `;
    bubble.appendChild(fileBox);
  }

  const textDiv = document.createElement("div");
  textDiv.className = "message-text";
  if (type === "ai" && text) {
    textDiv.innerHTML = `<b>YASH AI: </b>${text}`;
  } else {
    textDiv.textContent = text || "";
  }
  bubble.appendChild(textDiv);

  chat.appendChild(bubble);
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
  return bubble;
}

function addTypingBubble() {
  const chat = document.getElementById("chat");
  const bubble = document.createElement("div");
  bubble.className = "bubble ai message-fade-in";
  bubble.id = "typingBubble";
  
  const textDiv = document.createElement("div");
  textDiv.className = "message-text";
  textDiv.innerHTML = `<b>YASH AI: </b><span id="ai-response-text"></span><span class="typing-indicator" id="typingIndicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span>`;
  bubble.appendChild(textDiv);

  chat.appendChild(bubble);
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
  return bubble;
}

// ============================================
// TYPING EFFECT
// ============================================

function typeStreamedText() {
    const textElement = document.getElementById("ai-response-text");
    if (!textElement) {
        if (typingInterval) clearInterval(typingInterval);
        typingInterval = null;
        return;
    }

    if (displayIndex < streamedText.length) {
        textElement.textContent += streamedText.charAt(displayIndex);
        displayIndex++;
        
        const chat = document.getElementById("chat");
        chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
    } else {
        clearInterval(typingInterval);
        typingInterval = null;
    }
}

function updateTypingBubble(newChunk) {
  streamedText += newChunk; 
  if (!typingInterval) {
      typingInterval = setInterval(typeStreamedText, TYPING_DELAY);
  }
}

function finishTypingBubble(finalText, speakFlag) {
  const bubble = document.getElementById("typingBubble");
  const indicator = document.getElementById("typingIndicator");

  if (!bubble) return;
  
  if (typingInterval) clearInterval(typingInterval);
  typingInterval = null;
  streamedText = "";
  displayIndex = 0;
  
  bubble.removeAttribute("id");
  if (indicator) indicator.remove();
  
  let textDiv = bubble.querySelector(".message-text");
  if (textDiv) {
      textDiv.innerHTML = `<b>YASH AI: </b>${finalText}`;
  }
  
  const chat = document.getElementById("chat");
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });

  if (speakFlag) speak(finalText);
  
  // ============ AD TRIGGER ============
  answerCount++;
  console.log(`Answer count: ${answerCount}`);
  if (answerCount % AD_FREQUENCY === 0) {
    setTimeout(() => {
      console.log('Showing ad...');
      showAd();
    }, 1000);
  }
}

function speak(text) {
  if (!("speechSynthesis" in window)) return;
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  
  const voices = window.speechSynthesis.getVoices();
  const preferredVoice = voices.find(v => 
    v.name.includes("Google") || v.lang.startsWith("en")
  );
  
  if (preferredVoice) utterance.voice = preferredVoice;
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  
  window.speechSynthesis.speak(utterance);
}

/* -----------------------
   Speech (TTS) function (IMPROVED VOICE SELECTION)
   ----------------------- */
function speak(text) {
  if (!("speechSynthesis" in window)) return;
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  
  // Choose a preferred high-quality/natural voice
  const voices = window.speechSynthesis.getVoices();
  
  // Preferred voices in order: Google/Microsoft US/UK, then any other "English"
  const preferredVoiceNames = [
    "Google US English", 
    "Microsoft Zira - English (United States)", 
    "Google UK English Female", 
    "Microsoft David - English (United States)",
    "en-US", 
    "en-GB"
  ];

  let chosen = voices.find(v => 
    preferredVoiceNames.some(p => 
      v.name.includes(p) || v.lang.includes(p)
    ) && v.localService // Prioritize local voices for better quality if available
  );

  // Fallback to any English voice
  if (!chosen) {
    chosen = voices.find(v => v.lang.startsWith("en"));
  }
  
  // Final fallback to the first available voice
  if (!chosen && voices.length) chosen = voices[0];
  
  if (chosen) utterance.voice = chosen;
  
  // Set rate/pitch for better delivery
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  utterance.lang = chosen?.lang || "en-US";
  
  window.speechSynthesis.speak(utterance);
}


/* =======================
   UI utilities (kept original behavior)
   ======================= */

function formatFileSize(bytes) {
  if (!bytes) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
}

function createFeedbackButtons(bubbleElement) {
  const feedbackContainer = document.createElement("div");
  feedbackContainer.className = "feedback-container";

  // Copy Button
  const copyBtn = document.createElement("button");
  copyBtn.className = "copy-btn";
  copyBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>
    <span></span>
  `;
  
  copyBtn.onclick = () => {
    const messageText = bubbleElement.querySelector(".message-text");
    if (messageText) {
      // Extract only the text content, excluding the "YASH AI:" label
      let textToCopy = messageText.textContent || messageText.innerText;
      textToCopy = textToCopy.replace(/^YASH AI:\s*/, '').trim();
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalHTML = copyBtn.innerHTML;
        copyBtn.classList.add("copied");
        copyBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span>Copied!</span>
        `;
        
        setTimeout(() => {
          copyBtn.classList.remove("copied");
          copyBtn.innerHTML = originalHTML;
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy text');
      });
    }
  };

  const thumbsUp = document.createElement("button");
  thumbsUp.className = "feedback-btn thumbs-up";
  thumbsUp.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>`;

  const thumbsDown = document.createElement("button");
  thumbsDown.className = "feedback-btn thumbs-down";
  thumbsDown.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2.31 2.31 0 0 1-2-1.7l-1.38 9a2.31 2.31 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg>`;

  let feedbackForm = null;
  const removeForm = () => { if (feedbackForm) { feedbackForm.remove(); feedbackForm = null; } };

  const createForm = () => {
    removeForm();
    feedbackForm = document.createElement("div");
    feedbackForm.className = "feedback-form";
    feedbackForm.innerHTML = `<textarea placeholder="Please tell us what went wrong so we can improve the response..."></textarea>
      <div class="feedback-form-actions">
        <button class="feedback-form-btn cancel">Cancel</button>
        <button class="feedback-form-btn submit">Submit Feedback</button>
      </div>`;
    bubbleElement.appendChild(feedbackForm);
    const textarea = feedbackForm.querySelector("textarea");
    const cancelBtn = feedbackForm.querySelector(".cancel");
    const submitBtn = feedbackForm.querySelector(".submit");

    cancelBtn.onclick = () => { removeForm(); thumbsDown.classList.remove("active"); };
    submitBtn.onclick = () => {
      const feedback = textarea.value.trim();
      if (feedback) {
        alert("Thank you for your feedback!");
        removeForm();
      } else {
        alert("Please enter your feedback.");
      }
    };
    textarea.focus();
  };

  thumbsUp.onclick = () => {
    if (thumbsUp.classList.contains("active")) {
      thumbsUp.classList.remove("active");
      removeForm();
    } else {
      thumbsUp.classList.add("active");
      thumbsDown.classList.remove("active");
      removeForm();
    }
  };

  thumbsDown.onclick = () => {
    if (thumbsDown.classList.contains("active")) {
      thumbsDown.classList.remove("active");
      removeForm();
    } else {
      thumbsDown.classList.add("active");
      thumbsUp.classList.remove("active");
      createForm();
    }
  };

  feedbackContainer.appendChild(copyBtn);
  feedbackContainer.appendChild(thumbsUp);
  feedbackContainer.appendChild(thumbsDown);
  return feedbackContainer;
}

/* addBubble: same behavior as your original file, supports file attachment */
function addBubble(type, text, fileAttachment = null) {
  const chat = document.getElementById("chat");
  const b = document.createElement("div");
  b.className = "bubble " + type + " message-fade-in";

  if (fileAttachment) {
    const fileBox = document.createElement("div");
    fileBox.className = "file-attachment-box";
    const fileSize = formatFileSize(fileAttachment.size);
    fileBox.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
      </svg>
      <div class="file-info">
        <div class="file-name">${fileAttachment.name}</div>
        <div class="file-size">${fileSize} (${fileAttachment.type || "Unknown"})</div>
      </div>
    `;
    b.appendChild(fileBox);
  }

  const textContent = document.createElement("div");
  textContent.className = "message-text";
  if (type === "ai" && text) {
    textContent.innerHTML = `<b>YASH AI: </b>${text}`;
  } else {
    textContent.innerHTML = text || "";
  }
  b.appendChild(textContent);

  if (type === "ai" && text) {
    const fb = createFeedbackButtons(b);
    b.appendChild(fb);
  }

  chat.appendChild(b);
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
  return b;
}

/* Typing bubble helpers */
function addTypingBubble() {
  const chat = document.getElementById("chat");
  const bubble = document.createElement("div");
  bubble.className = "bubble ai message-fade-in";
  bubble.id = "typingBubble";
  
  const textDiv = document.createElement("div");
  textDiv.className = "message-text";
  // The initial text includes the typing indicator dots
  textDiv.innerHTML = `<b>YASH AI: </b><span id="ai-response-text"></span><span class="typing-indicator" id="typingIndicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span>`;
  bubble.appendChild(textDiv);

  chat.appendChild(bubble);
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
  return bubble;
}

// --- CORE FIX: Manages the actual character-by-character display ---
function typeStreamedText() {
    const textElement = document.getElementById("ai-response-text");
    if (!textElement) {
        if (typingInterval) clearInterval(typingInterval);
        typingInterval = null;
        return;
    }

    if (displayIndex < streamedText.length) {
        // Only append one new character
        textElement.textContent += streamedText.charAt(displayIndex);
        displayIndex++;
        
        // Scroll down
        const chat = document.getElementById("chat");
        chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });

    } else if (displayIndex >= streamedText.length) {
        // If we have caught up to the streamed text, stop the interval
        // It will be restarted by updateTypingBubble when a new chunk arrives
        clearInterval(typingInterval);
        typingInterval = null;
    }
}

// FIX: This function now just updates the total streamedText and ensures typing is active
function updateTypingBubble(newChunk) {
  streamedText += newChunk; 
  // If typing is not currently running, start it
  if (!typingInterval) {
      typingInterval = setInterval(typeStreamedText, TYPING_DELAY);
  }
}

function finishTypingBubble(finalText, speakFlag) {
  const bubble = document.getElementById("typingBubble");
  const indicator = document.getElementById("typingIndicator");

  if (!bubble) return;
  
  // 1. Clear the typing interval
  if (typingInterval) clearInterval(typingInterval);
  typingInterval = null;
  streamedText = ""; // Reset state
  displayIndex = 0; // Reset state
  
  bubble.removeAttribute("id");

  // 2. Remove indicator and ensure final content is present
  if (indicator) indicator.remove();
  
  let textDiv = bubble.querySelector(".message-text");
  if (textDiv) {
      // FIX APPLIED HERE: Use innerHTML to explicitly include the 'YASH AI:' bold tag.
      textDiv.innerHTML = `<b>YASH AI: </b>${finalText}`;
  }
  
  // 3. Attach feedback buttons
  const fb = createFeedbackButtons(bubble);
  bubble.appendChild(fb);
  
  const chat = document.getElementById("chat");
  chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });

  if (speakFlag) speak(finalText);
}

/* -----------------------
   Speech (TTS) function (IMPROVED VOICE SELECTION)
   ----------------------- */
function speak(text) {
  if (!("speechSynthesis" in window)) return;
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  
  // Choose a preferred high-quality/natural voice
  const voices = window.speechSynthesis.getVoices();
  
  // Preferred voices in order: Google/Microsoft US/UK, then any other "English"
  const preferredVoiceNames = [
    "Google US English", 
    "Microsoft Zira - English (United States)", 
    "Google UK English Female", 
    "Microsoft David - English (United States)",
    "en-US", 
    "en-GB"
  ];

  let chosen = voices.find(v => 
    preferredVoiceNames.some(p => 
      v.name.includes(p) || v.lang.includes(p)
    ) && v.localService // Prioritize local voices for better quality if available
  );

  // Fallback to any English voice
  if (!chosen) {
    chosen = voices.find(v => v.lang.startsWith("en"));
  }
  
  // Final fallback to the first available voice
  if (!chosen && voices.length) chosen = voices[0];
  
  if (chosen) utterance.voice = chosen;
  
  // Set rate/pitch for better delivery
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  utterance.lang = chosen?.lang || "en-US";
  
  window.speechSynthesis.speak(utterance);
}


/* =========================
   Main DOMContentLoaded wiring
   ========================= */
document.addEventListener("DOMContentLoaded", function () {
  const introScreen = document.getElementById("introScreen");
  const mainApp = document.getElementById("mainApp");
  const tutorialPage = document.getElementById("tutorialPage");
  const startChatBtn = document.getElementById("startChatBtn");
  const chat = document.getElementById("chat");
  const header = document.querySelector(".header");
  const input = document.getElementById("input");
  const send = document.getElementById("send");
  const file = document.getElementById("file");
  const micButton = document.getElementById("micButton");
  const fileButton = document.getElementById("fileButton");
  const multiFunctionContainer = document.getElementById("multiFunctionContainer");
  const composer = document.getElementById("composer");
  const stagedFileChip = document.getElementById("stagedFileChip");
  const stagedFileName = document.getElementById("stagedFileName");
  const clearFileBtn = document.getElementById("clearFileBtn");

  // Hamburger menu elements
  const hamburgerMenu = document.getElementById("hamburgerMenu");
  const sidebarMenu = document.getElementById("sidebarMenu");
  const sidebarOverlay = document.getElementById("sidebarOverlay");
  const sidebarClose = document.getElementById("sidebarClose");
  const menuNewChat = document.getElementById("menuNewChat");
  const aboutBtn = document.getElementById("about-btn");
  const menuComingSoon = document.getElementById("menuComingSoon");
  const aboutModal = document.getElementById("about-modal");
  const comingSoonModal = document.getElementById("comingSoonModal");
  const comingSoonClose = document.getElementById("comingSoonClose");

  let activeFunction = "file";
  let startY = 0;
  let isDragging = false;
  let dragThresholdMet = false;
  const DRAG_THRESHOLD = 10;
  const TAP_TOLERANCE = 10;
  let userUsedVoice = false;

  
 /* Intro logic - Always show tutorial */
  setTimeout(() => {
    introScreen.classList.add("hidden");
    
    // Always show tutorial page
    setTimeout(() => {
      tutorialPage.style.display = "flex";
      setTimeout(() => { tutorialPage.style.opacity = "1"; }, 50);
    }, 600);
  }, 3500);

  // Start Chat Button (Tutorial)
  if (startChatBtn) {
    startChatBtn.onclick = function() {
     
      
      tutorialPage.style.opacity = "0";
      setTimeout(() => {
        tutorialPage.style.display = "none";
        mainApp.classList.add("visible");
        addBubble("ai", "Hello! I'm YASH AI. How can I help you today?");
      }, 300);
    };
  }

  // Hamburger Menu Logic
  hamburgerMenu.addEventListener('click', () => {
    sidebarMenu.classList.add('open');
    sidebarOverlay.classList.add('open');
  });

  sidebarClose.addEventListener('click', () => {
    sidebarMenu.classList.remove('open');
    sidebarOverlay.classList.remove('open');
  });

  sidebarOverlay.addEventListener('click', () => {
    sidebarMenu.classList.remove('open');
    sidebarOverlay.classList.remove('open');
  });

  // New Chat
  menuNewChat.addEventListener('click', () => {
    chat.innerHTML = '';
    addBubble("ai", "New conversation started! What can I help you with?");
    sidebarMenu.classList.remove('open');
    sidebarOverlay.classList.remove('open');
  });

  // About Creator
  aboutBtn.addEventListener('click', () => {
    aboutModal.style.display = 'flex';
    sidebarMenu.classList.remove('open');
    sidebarOverlay.classList.remove('open');
  });

  // Coming Soon
  menuComingSoon.addEventListener('click', () => {
    comingSoonModal.classList.add('open');
    sidebarMenu.classList.remove('open');
    sidebarOverlay.classList.remove('open');
  });

  comingSoonClose.addEventListener('click', () => {
    comingSoonModal.classList.remove('open');
  });

  // Close About Modal
  window.closeAbout = function() {
    aboutModal.style.display = 'none';
  };

  window.addEventListener('click', (e) => {
    if (e.target === aboutModal) closeAbout();
    if (e.target === comingSoonModal) comingSoonModal.classList.remove('open');
  });

  // Notify Button
  setTimeout(() => {
    const notifyBtn = document.querySelector('.notify-btn');
    if (notifyBtn) {
      notifyBtn.addEventListener('click', () => {
        alert('Thanks for your interest! We\'ll notify you when new features launch.');
      });
    }
  }, 500);

  /* UI & animation handlers */
  input.onfocus = () => { composer.classList.add("focused"); };
  input.onblur = () => { composer.classList.remove("focused"); };

  chat.onscroll = () => {
    if (chat.scrollTop > 10) header.classList.add("minimized");
    else header.classList.remove("minimized");
  };

  // ... REST OF YOUR EXISTING JAVASCRIPT CODE CONTINUES HERE ...
  // (Keep all the drag/drop, speech recognition, file upload, send logic, etc.)

  function toggleFunctionButtons(switchTo) {
    if (!switchTo) switchTo = activeFunction === "file" ? "mic" : "file";
    activeFunction = switchTo;
    if (activeFunction === "mic") multiFunctionContainer.classList.add("expanded");
    else multiFunctionContainer.classList.remove("expanded");
  }
  toggleFunctionButtons("file");

  function handleDragStart(e) {
    if (e.target.closest(".multi-function-container") !== multiFunctionContainer) return;
    isDragging = true; dragThresholdMet = false;
    startY = e.type.includes("mouse") ? e.clientY : e.touches[0].clientY;
    fileButton.classList.add("dragging"); micButton.classList.add("dragging");
  }
  function handleDragMove(e) {
    if (!isDragging) return;
    const currentY = e.type.includes("mouse") ? e.clientY : e.touches[0].clientY;
    const deltaY = startY - currentY;
    const isDraggingUp = deltaY > 0;
    const isDraggingDown = deltaY < 0;
    let shouldPreview = false;
    let switchDirection = 0;

    if (activeFunction === "file" && isDraggingUp) { if (e.cancelable) e.preventDefault(); shouldPreview = true; switchDirection = 1; }
    else if (activeFunction === "mic" && isDraggingDown) { shouldPreview = true; switchDirection = -1; }

    if (shouldPreview) {
      const absDeltaY = Math.abs(deltaY);
      const previewTranslateY = Math.min(absDeltaY, DRAG_THRESHOLD + TAP_TOLERANCE);
      const progress = previewTranslateY / (DRAG_THRESHOLD + TAP_TOLERANCE);
      const limitedProgress = Math.min(absDeltaY / DRAG_THRESHOLD, 1);

      if (switchDirection === 1) {
        fileButton.style.transform = `translateY(-${previewTranslateY}px) scale(${1 - progress * 0.15})`;
        micButton.style.opacity = `${limitedProgress}`;
        micButton.style.transform = `scale(${0.8 + limitedProgress * 0.2})`;
      } else {
        micButton.style.transform = `translateY(${previewTranslateY}px) scale(${1 - progress * 0.15})`;
        fileButton.style.opacity = `${limitedProgress}`;
        fileButton.style.transform = `scale(${1 - progress * 0.1})`;
      }

      if (absDeltaY > DRAG_THRESHOLD) dragThresholdMet = true;
    } else {
      fileButton.style.transform = ""; fileButton.style.opacity = "";
      micButton.style.opacity = ""; micButton.style.transform = "";
      dragThresholdMet = false;
    }
  }
  function handleDragEnd(e) {
    if (!isDragging) return;
    const finalY = e.type.includes("mouse") ? e.clientY : (e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientY : startY);
    const deltaY = startY - finalY;
    isDragging = false;
    fileButton.style.transform = ""; fileButton.style.opacity = "";
    micButton.style.opacity = ""; micButton.style.transform = "";
    fileButton.classList.remove("dragging"); micButton.classList.remove("dragging");

    if (dragThresholdMet) {
      const isDragUp = deltaY > 0;
      const isDragDown = deltaY < 0;
      let didToggle = false;
      if (activeFunction === "file" && isDragUp) { toggleFunctionButtons("mic"); didToggle = true; }
      else if (activeFunction === "mic" && isDragDown) { toggleFunctionButtons("file"); didToggle = true; }
      if (!didToggle) toggleFunctionButtons(activeFunction);
      dragThresholdMet = false;
      return;
    }
  }

  multiFunctionContainer.addEventListener("mousedown", handleDragStart);
  multiFunctionContainer.addEventListener("touchstart", handleDragStart, { passive: true });
  document.addEventListener("mousemove", handleDragMove);
  document.addEventListener("touchmove", handleDragMove, { passive: false });
  document.addEventListener("mouseup", handleDragEnd);
  document.addEventListener("touchend", handleDragEnd);

  fileButton.onclick = (e) => {
    if (activeFunction !== "file") { e.preventDefault(); e.stopPropagation(); return false; }
  };

   /* -----------------------
     Speech recognition & synthesis
     ----------------------- */
  let recognition = null;
  let isListening = false;

  if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;
    recognition.lang = "en-US";

    recognition.onstart = () => {
      isListening = true;
      micButton.classList.add("listening");
      input.placeholder = "Listening...";
      userUsedVoice = true;
    };

    recognition.onresult = (event) => {
      let transcript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        transcript += event.results[i][0].transcript;
      }
      if (event.results[0].isFinal || transcript.length > 0) {
        input.value = transcript;
        autoResizeTextarea();
      }
    };

    recognition.onerror = (event) => {
      console.error("Speech recognition error:", event.error);
      micButton.classList.remove("listening");
      input.placeholder = selectedFile ? "Add a message about your file (optional)..." : "Ask anything...";
      isListening = false;
      userUsedVoice = false;
      if (event.error === "no-speech") addBubble("ai", "I didn't hear anything. Please try again.", null);
      else if (event.error === "not-allowed") addBubble("ai", "Microphone access denied. Please enable microphone permissions.", null);
      else if (event.error === "network") addBubble("ai", "Voice error: Network connection lost.", null);
    };

    recognition.onend = () => {
      micButton.classList.remove("listening");
      input.placeholder = selectedFile ? "Add a message about your file (optional)..." : "Ask anything...";
      isListening = false;
      // auto-send if text exists
      if (input.value && input.value.trim().length > 0) {
        send.click();
      }
    };
  }

  micButton.onclick = (e) => {
    if (activeFunction !== "mic") { e.preventDefault(); e.stopPropagation(); return; }
    if (!recognition) { addBubble("ai", "Sorry, speech recognition is not supported in your browser.", null); return; }
    if (isListening) recognition.stop(); else recognition.start();
  };

  /* -----------------------
     Auto-resize textarea
     ----------------------- */
  function autoResizeTextarea() {
    const chatEl = document.getElementById("chat");
    const scrollPosition = chatEl.scrollTop + chatEl.clientHeight;
    const scrollHeight = chatEl.scrollHeight;

    input.style.height = "auto";
    const newHeight = input.scrollHeight;
    input.style.height = newHeight + "px";

    if (scrollPosition >= scrollHeight) {
      chatEl.scrollTo({ top: chatEl.scrollHeight, behavior: "smooth" });
    }
  }
  input.addEventListener("input", autoResizeTextarea);
  autoResizeTextarea();

  /* -----------------------
     File input handler (select & upload)
     ----------------------- */
  file.onchange = (e) => {
  const fileToSend = e.target.files[0];
  if (!fileToSend) return;

  // store file, do NOT send yet
  selectedFile = fileToSend;

  // show preview chip only
  stagedFileName.textContent = fileToSend.name;
  stagedFileChip.style.display = "flex";
};

  

  clearFileBtn.addEventListener("click", () => {
    selectedFile = null; // Corrected to use selectedFile
    file.value = null;
    stagedFileChip.style.display = "none";
    stagedFileName.textContent = "";
  });
send.onclick = async () => {
    const text = input.value.trim();

    if (!text && !selectedFile) return;

    // 1. Add User Bubble and clear input
    addBubble("user", text, selectedFile);
    input.value = "";
    autoResizeTextarea();
    
    // Store file reference for upload and immediately clear file UI.
    const fileToUpload = selectedFile; 
    selectedFile = null;
    file.value = "";
    stagedFileChip.style.display = "none"; 
    
    // *** CHECK FOR FIXED RESPONSES FIRST ***
    // *** CHECK FOR FIXED RESPONSES FIRST ***
const fixedResponse = getFixedResponse(text);

if (fixedResponse && !fileToUpload) {
  // If we have a fixed response and no file, show it with typing effect
  simulateTypingEffect(fixedResponse, userUsedVoice);
  userUsedVoice = false;
  return; // Don't call backend
}

    // Reset typing state before starting new stream
    streamedText = ""; 
    displayIndex = 0;
    if (typingInterval) {
        clearInterval(typingInterval);
        typingInterval = null;
    }

    // 2. Show Typing Indicator
    const typingBubble = addTypingBubble();

    try {
      if (fileToUpload) {
        // --- FILE UPLOAD PATH ---
        const fileResponse = await uploadFileToBackend(fileToUpload, text);
        const ans = fileResponse.message || "File uploaded and processed successfully. Please see the terminal for backend details.";
        finishTypingBubble(ans, userUsedVoice); 

      } else {
        // --- TEXT STREAMING PATH ---
        let finalResponse = "";
        
        await streamFromBackend(text, 
          (chunk) => {
            updateTypingBubble(chunk);
          }, 
          () => {
            // Stream ended
          }
        );
        
        finalResponse = streamedText;
        finishTypingBubble(finalResponse, userUsedVoice); 
      }
    } catch (err) {
      console.error("Chat/Upload Error:", err);
      const errorMessage = streamedText || "Something went wrong. Please check your backend connection.";
      finishTypingBubble(errorMessage, false);
    }

    // 4. Final cleanup
    userUsedVoice = false;
  };

});

// ===== INTERACTIVE TUTORIAL DEMO =====
document.addEventListener('DOMContentLoaded', function() {
    const demoContainer = document.getElementById('demoButtonsContainer');
    const demoFileBtn = document.getElementById('demoFileBtn');
    const demoMicBtn = document.getElementById('demoMicBtn');
    const demoInstruction = document.getElementById('demoInstruction');
    const tutorialSkip = document.getElementById('tutorialSkip');

    if (demoContainer && demoFileBtn && demoMicBtn) {
        let demoStartY = 0;
        let isDemoDragging = false;
        let currentDemoMode = 'file'; // 'file' or 'mic'

        function switchDemoButton(mode) {
    if (mode === 'mic') {
        demoFileBtn.classList.remove('active');
        demoMicBtn.classList.add('active');
        
        // When switched to MIC, show DOWN arrow to go back
        demoInstruction.innerHTML = `
            <div class="swipe-indicator">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- DOWN ARROW -->
                    <path d="M12 5v14M5 12l7 7 7-7"/>
                </svg>
            </div>
            <span>Great! Now swipe DOWN to go back</span>
        `;
        currentDemoMode = 'mic';
    } else {
        demoMicBtn.classList.remove('active');
        demoFileBtn.classList.add('active');
        
        // When back to FILE, show UP arrow again
        demoInstruction.innerHTML = `
            <div class="swipe-indicator">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- UP ARROW -->
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                </svg>
            </div>
            <span>Perfect! Try swiping UP again</span>
        `;
        currentDemoMode = 'file';
    }
}

        function handleDemoStart(e) {
            isDemoDragging = true;
            demoStartY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        }

        function handleDemoMove(e) {
            if (!isDemoDragging) return;
            const currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            const deltaY = demoStartY - currentY;

            if (Math.abs(deltaY) > 30) { // Threshold for switch
                if (deltaY > 0 && currentDemoMode === 'file') {
                    switchDemoButton('mic');
                    isDemoDragging = false;
                } else if (deltaY < 0 && currentDemoMode === 'mic') {
                    switchDemoButton('file');
                    isDemoDragging = false;
                }
            }
        }

        function handleDemoEnd() {
            isDemoDragging = false;
        }

        demoContainer.addEventListener('mousedown', handleDemoStart);
        demoContainer.addEventListener('touchstart', handleDemoStart, { passive: true });
        document.addEventListener('mousemove', handleDemoMove);
        document.addEventListener('touchmove', handleDemoMove, { passive: true });
        document.addEventListener('mouseup', handleDemoEnd);
        document.addEventListener('touchend', handleDemoEnd);
    }

    // Skip tutorial
    if (tutorialSkip) {
        tutorialSkip.addEventListener('click', function() {
            localStorage.setItem('hasVisitedYashAI', 'true');
            const tutorialPage = document.getElementById('tutorialPage');
            const mainApp = document.getElementById('mainApp');
            
            tutorialPage.style.opacity = "0";
            setTimeout(() => {
                tutorialPage.style.display = "none";
                mainApp.classList.add("visible");
            }, 300);
        });
    }
});

</script>


<script>
// Character-by-character typing helper
function typeText(element, text, speed = 18) {
  let i = 0;
  function type() {
    if (i < text.length) {
      element.innerHTML += text.charAt(i++);
      setTimeout(type, speed);
    }
  }
  type();
}

// Wrap finishTypingBubble to add typing effect safely
(function () {
  if (typeof window.finishTypingBubble !== "function") return;
  const _finish = window.finishTypingBubble;
  window.finishTypingBubble = function(finalText, speakFlag) {
    try {
      const bubble = document.getElementById("typingBubble");
      if (!bubble) return _finish(finalText, speakFlag);

      bubble.removeAttribute("id");
      const indicator = bubble.querySelector(".typing-indicator");
      if (indicator) indicator.remove();

      const textDiv = bubble.querySelector(".message-text");
      if (textDiv) {
        textDiv.style.display = "block";
        // Set the label before the final typing effect starts.
        textDiv.innerHTML = `<b>YASH AI:</b>`;
        typeText(textDiv, finalText);
      } else {
        return _finish(finalText, speakFlag);
      }

      // feedback buttons (if your app has them)
      if (typeof window.createFeedbackButtons === "function") {
        const fb = window.createFeedbackButtons(bubble);
        if (fb) bubble.appendChild(fb);
      }

      // speak AFTER typing finishes
      if (speakFlag && typeof window.speak === "function") {
        setTimeout(() => window.speak(finalText), finalText.length * 18 + 300);
      }
    } catch (e) {
      // fallback to original behavior on any error
      return _finish(finalText, speakFlag);
    }
  };
})();

async function sendMessage(userText) {
  addUserMessage(userText);

  const res = await fetch("https://backend-1-2sem.onrender.com", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: userText })
  });

  const data = await res.json();
  addAIMessage(data.reply);
}



console.log('%cðŸš€ YASH AI Loaded Successfully!', 'color: #00ffff; font-size: 16px; font-weight: bold;');
console.log('%c Made with â¤ï¸ in India by Yash Dubey', 'color: #ff00ff; font-size: 12px;');
</script>

</body>

</html>






